<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Laundry ‚Äì Formulaire simple</title>
<style>
  :root { --ink:#0f172a; --mut:#475569; --bd:#e2e8f0; --bg:#ffffff; --chip:#f1f5f9; }
  *{box-sizing:border-box} body{font-family:system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin:0; color:var(--ink); background:var(--bg)}
  header{padding:16px 12px;border-bottom:1px solid var(--bd)} h1{margin:0;font-size:18px}
  .wrap{max-width:820px;margin:0 auto;padding:16px 12px}
  fieldset{border:1px solid var(--bd);border-radius:12px;padding:12px;margin:0 0 14px}
  legend{padding:0 6px;color:var(--mut);font-size:12px}
  .grid{display:grid;gap:8px}
  .grid-2{grid-template-columns:1fr 1fr}
  .row{display:flex;gap:8px;align-items:center}
  label{font-size:14px}
  input[type=number], input[type=range]{width:100%;padding:8px;border:1px solid var(--bd);border-radius:8px}
  .help{font-size:12px;color:var(--mut)}
  .chip{display:inline-block;background:var(--chip);border:1px solid var(--bd);padding:2px 8px;border-radius:999px;font-size:12px;margin-left:6px}
  button{padding:10px 14px;border:1px solid var(--bd);border-radius:10px;background:#0ea5e9;color:white;cursor:pointer}
  button.secondary{background:#fff;color:#0f172a}
  table{width:100%;border-collapse:collapse;margin-top:10px}
  th,td{border-bottom:1px solid var(--bd);padding:8px;text-align:left;font-size:14px}
  .right{text-align:right}
  .warn{color:#b91c1c}
</style>
</head>
<body>
<header><h1>üß∫ Optimisateur de batt√©es ‚Äî Formulaire</h1></header>
<div class="wrap">

  <fieldset>
    <legend>Param√®tres</legend>
    <div class="grid grid-2">
      <label>Capacit√© machine (articles)
        <input id="capacity" type="number" min="1" value="8">
      </label>
      <label>Part de d√©licats (%, estim√©e)
        <input id="delicatePct" type="range" min="0" max="60" value="20" oninput="delicatePctOut.textContent=this.value+'%'">
        <div class="help">Estimation globale de pi√®ces d√©licates (laine, soie, sport). <span id="delicatePctOut">20%</span></div>
      </label>
    </div>
  </fieldset>

  <fieldset>
    <legend>Quantit√©s par couleur</legend>
    <div class="help" style="margin-bottom:6px">
      Saisis le nombre approximatif d‚Äôarticles pour chaque famille de couleur.
    </div>
    <div class="grid">
      <div class="row">
        <label style="min-width:220px">Blancs <span class="chip">t-shirts/draps blancs</span></label>
        <input type="number" min="0" value="2" data-color="Blancs">
      </div>
      <div class="row">
        <label style="min-width:220px">Pastels / Clairs <span class="chip">beige, gris clair, pastel</span></label>
        <input type="number" min="0" value="3" data-color="Clairs">
      </div>
      <div class="row">
        <label style="min-width:220px">Couleurs moyennes <span class="chip">bleu/vert classique</span></label>
        <input type="number" min="0" value="2" data-color="Couleurs">
      </div>
      <div class="row">
        <label style="min-width:220px">Vives / Rouges <span class="chip">rouge, fuchsia, orange vif</span></label>
        <input type="number" min="0" value="2" data-color="Vives">
      </div>
      <div class="row">
        <label style="min-width:220px">Fonc√©s / Noirs <span class="chip">marine, anthracite, noir</span></label>
        <input type="number" min="0" value="3" data-color="Fonc√©s">
      </div>
      <div class="row">
        <label style="min-width:220px">Denim <span class="chip">jeans (attention neuf)</span></label>
        <input type="number" min="0" value="1" data-color="Denim">
      </div>
    </div>
  </fieldset>

  <fieldset>
    <legend>Types particuliers (facultatif)</legend>
    <div class="grid grid-2">
      <label>Serviettes / Draps (chaud 60 ¬∞C)
        <input id="hotQty" type="number" min="0" value="0">
        <div class="help">Compter √† part (peluche, besoin de chaud).</div>
      </label>
      <label>Jeans neufs ?
        <input id="newJeans" type="checkbox">
        <div class="help">Si coch√© : s√©parer des clairs/pastels.</div>
      </label>
    </div>
  </fieldset>

  <div class="row" style="justify-content:flex-start;gap:10px;margin:10px 0">
    <button id="compute">Optimiser</button>
    <button class="secondary" id="reset">R√©initialiser</button>
  </div>

  <div id="output"></div>
</div>

<script>
const COLORS = [
  {key:"Blancs",   temp:40, cycle:"Coton/Blancs 40 ¬∞C", note:"√âviter avec Vives. Ajoute oxy-blanc si besoin."},
  {key:"Clairs",   temp:30, cycle:"Couleurs 30 ¬∞C",    note:"Pastels et beiges."},
  {key:"Couleurs", temp:30, cycle:"Couleurs 30 ¬∞C",    note:"Bleu/vert moyens."},
  {key:"Vives",    temp:30, cycle:"Couleurs 30 ¬∞C",    note:"Rouges/rose/orange vif : risquent de d√©teindre."},
  {key:"Fonc√©s",   temp:30, cycle:"Couleurs Fonc√©es 30 ¬∞C", note:"Marine/noir, retourner les v√™tements."},
  {key:"Denim",    temp:30, cycle:"Jeans 30 ¬∞C",       note:"Laver sur l‚Äôenvers. Jeans neufs √† part."}
];
const DELICATE = { temp:30, cycle:"D√©licat 20‚Äì30 ¬∞C", note:"Essorage r√©duit, lessive douce, filet si possible." };
const HOT = { temp:60, cycle:"Coton 60 ¬∞C", note:"Serviettes/draps/torchons (hygi√®ne, peluches)." };

const byKey = Object.fromEntries(COLORS.map(c=>[c.key,c]));
const $ = (sel, el=document)=> el.querySelector(sel);

$("#reset").addEventListener("click", ()=>{
  location.reload();
});

$("#compute").addEventListener("click", ()=>{
  const capacity = Math.max(1, Number($("#capacity").value||8));
  const delicatePct = Math.min(60, Math.max(0, Number($("#delicatePct").value||0))) / 100;
  const hotQty = Math.max(0, Number($("#hotQty").value||0));
  const newJeans = $("#newJeans").checked;

  // Lire quantit√©s par couleur
  const inputs = document.querySelectorAll("input[data-color]");
  const colorQty = {};
  let total = 0;
  inputs.forEach(inp=>{
    const k = inp.getAttribute("data-color");
    const n = Math.max(0, Number(inp.value||0));
    colorQty[k] = n;
    total += n;
  });

  // Allouer une partie en "d√©licat" (proportionnelle √† chaque couleur)
  const delicateLoads = [];  // {color,key,qty}
  const normalLoads   = [];  // {color,key,qty}
  for (const [k, n] of Object.entries(colorQty)) {
    if (n === 0) continue;
    const d = Math.round(n * delicatePct);
    const norm = n - d;
    if (d > 0) delicateLoads.push({key:k, qty:d});
    if (norm > 0) {
      // Jeans neufs : isoler dans Denim (normalLoads d√©j√† par couleur)
      normalLoads.push({key:k, qty:norm});
    }
  }

  // Ajouter le lot "chaud" pour serviettes/draps
  const hotLoads = hotQty>0 ? [{key:"Serviettes/Draps", qty:hotQty}] : [];

  // Fonction pour √©clater en batt√©es selon capacit√©
  function splitLoads(arr, capacity) {
    const out = [];
    arr.forEach(({key, qty})=>{
      const nLoads = Math.ceil(qty / capacity);
      for (let i=0;i<nLoads;i++){
        const count = (i === nLoads-1) ? (qty - capacity*i) : capacity;
        out.push({key, count});
      }
    });
    return out;
  }

  // Construire les batt√©es
  // 1) D√©licats (par couleur, m√™me si petite quantit√©, pour √©viter transferts)
  const loadsDelicate = splitLoads(delicateLoads, capacity).map(L=>({
    name: `${L.key} ¬∑ D√©licat`,
    count: L.count,
    temp: DELICATE.temp,
    cycle: DELICATE.cycle,
    note: DELICATE.note
  }));

  // 2) Chaud (serviettes/draps)
  const loadsHot = splitLoads(hotLoads, capacity).map(L=>({
    name: `${L.key}`,
    count: L.count,
    temp: HOT.temp,
    cycle: HOT.cycle,
    note: HOT.note
  }));

  // 3) Normaux par couleur (Blancs, Clairs, Couleurs, Vives, Fonc√©s, Denim)
  const loadsNormal = splitLoads(normalLoads, capacity).map(L=>{
    const meta = byKey[L.key] || {temp:30, cycle:"Couleurs 30 ¬∞C", note:""};
    return {
      name: `${L.key}`,
      count: L.count,
      temp: meta.temp,
      cycle: meta.cycle,
      note: meta.note + (L.key==="Denim" && newJeans ? " S√©parer les jeans NEUFS la premi√®re fois." : "")
    };
  });

  // Fusionner l‚Äôordre conseill√© : D√©licats ‚Üí Normal par temp croissant ‚Üí Chaud
  const allLoads = [...loadsDelicate, ...loadsNormal.sort((a,b)=>a.temp-b.temp), ...loadsHot];

  // R√©sum√© + avertissements
  const warnings = [];
  if ((colorQty["Blancs"]||0) > 0 && ((colorQty["Vives"]||0) > 0)) {
    warnings.push("√âvite de m√©langer Blancs et Vives (risque de transfert).");
  }
  if ((colorQty["Denim"]||0) > 0 && newJeans) {
    warnings.push("Jeans neufs : laver s√©par√©ment (ils d√©teignent).");
  }

  // Rendu
  const out = $("#output");
  out.innerHTML = renderLoads(allLoads, capacity, warnings);
});

function renderLoads(loads, capacity, warnings){
  if (!loads.length) return `<p class="help">Renseigne au moins une quantit√© pour calculer.</p>`;
  let html = `
    <h3>Plan minimal : ${loads.length} batt√©e(s)</h3>
    <div class="help">Capacit√© choisie : ${capacity} article(s) par batt√©e.</div>
    <table>
      <thead><tr><th>#</th><th>Lot</th><th>Cycle recommand√©</th><th>Temp.</th><th class="right">Qt√©</th></tr></thead>
      <tbody>
  `;
  loads.forEach((L, i)=>{
    html += `<tr>
      <td>${i+1}</td>
      <td>${L.name}</td>
      <td>${L.cycle}</td>
      <td>${L.temp} ¬∞C</td>
      <td class="right">${L.count}</td>
    </tr>
    <tr><td></td><td colspan="4" class="help">${L.note||"&nbsp;"}</td></tr>`;
  });
  html += `</tbody></table>`;
  if (warnings.length){
    html += `<p class="warn"><b>Attention :</b> ${warnings.join(" ")}</p>`;
  }
  return html;
}
</script>
</body>
</html>
